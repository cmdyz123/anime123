import{r as i,p as D,o as F,a as s,d as t,t as m,w as g,v as M,f as I,F as k,e as h,m as N,u as P,g as l,B as j}from"./vendor-BQIWbYX8.js";import{_ as q,f as z}from"./index-C5-_rSnE.js";const G={class:"category-manager"},H={key:0},Q={class:"header-section"},W={class:"nav-buttons"},X={class:"category-form"},Y={class:"category-list"},Z=["onUpdate:modelValue","onBlur","onKeyup"],x=["onClick"],ee={class:"category-actions"},te=["onClick"],ae=["onClick"],ne=["onClick"],oe={class:"batch-category"},se=["value"],le={class:"anime-categories"},ue=["value"],ie=["onUpdate:modelValue","onChange"],re=["value"],ve={class:"save-section"},ce={key:1},de={__name:"CategoryManager",setup(me){const _=P(),B=D(),E=i(localStorage.getItem("userRole")||"user"),r=i(B.params.month||"2025.10"),u=i(JSON.parse(localStorage.getItem(`animeCategories${r.value}`))||[{name:"原创动画"},{name:"动画官网"},{name:"PV"},{name:"先行画面"}]),d=i(""),p=i([]),c=i(-1),f=i(""),y=i([]),C=i(""),S=()=>{d.value.trim()&&(u.value.push({name:d.value.trim()}),d.value="",b())},U=n=>{u.value.splice(n,1),b()},b=()=>{localStorage.setItem(`animeCategories${r.value}`,JSON.stringify(u.value))},$=n=>{c.value=n,f.value=u.value[n].name},V=n=>{u.value[n].name.trim()?(c.value=-1,b()):(u.value[n].name=f.value,c.value=-1)},J=n=>{u.value[n].name=f.value,c.value=-1},O=()=>{if(!C.value){alert("请选择分类");return}y.value.forEach(n=>{const e=p.value.find(a=>a.id===n);e&&(e.category=C.value)}),A(),y.value=[]},R=n=>{A()},A=()=>{localStorage.setItem(`animeList${r.value}`,JSON.stringify(p.value))},w=()=>{let n=JSON.parse(localStorage.getItem(`animeList${r.value}`))||[];const e=z(n);p.value=e,JSON.stringify(e)!==JSON.stringify(n)&&A()},L=()=>{_.push({name:"MonthEditor",params:{month:r.value}})},K=()=>{_.push({name:"AnimeMonth",params:{month:r.value}})},T=()=>{_.push({name:"RestrictedView"})};return F(()=>{w()}),(n,e)=>(l(),s("div",G,[E.value==="admin"?(l(),s("div",H,[t("div",Q,[t("h1",null,m(r.value.value)+" 分类管理",1),t("div",W,[t("button",{class:"nav-btn",onClick:K},"主页面"),t("button",{class:"nav-btn",onClick:L},"动漫编辑"),t("button",{class:"nav-btn save-btn",onClick:e[0]||(e[0]=(...a)=>n.saveAllChanges&&n.saveAllChanges(...a))},"保存所有更改")])]),t("div",X,[e[5]||(e[5]=t("h2",null,"添加新分类",-1)),g(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>d.value=a),placeholder:"输入分类名称",onKeyup:I(S,["enter"])},null,544),[[M,d.value]]),t("button",{onClick:S},"添加")]),t("div",Y,[e[6]||(e[6]=t("h2",null,"现有分类",-1)),(l(!0),s(k,null,h(u.value,(a,o)=>(l(),s("div",{key:o,class:"category-item"},[c.value===o?g((l(),s("input",{key:0,type:"text","onUpdate:modelValue":v=>u.value[o].name=v,onBlur:v=>V(o),onKeyup:I(v=>V(o),["enter"]),class:"edit-input"},null,40,Z)),[[M,u.value[o].name]]):(l(),s("span",{key:1,onClick:v=>$(o)},m(a.name),9,x)),t("div",ee,[c.value===o?(l(),s("button",{key:0,onClick:v=>J(o)},"取消",8,te)):(l(),s("button",{key:1,onClick:v=>$(o)},"编辑",8,ae)),t("button",{onClick:v=>U(o)},"删除",8,ne)])]))),128))]),t("div",oe,[e[8]||(e[8]=t("h2",null,"批量分类",-1)),g(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>C.value=a)},[e[7]||(e[7]=t("option",{value:""},"选择分类",-1)),(l(!0),s(k,null,h(u.value,a=>(l(),s("option",{key:a.name,value:a.name},m(a.name),9,se))),128))],512),[[N,C.value]]),t("button",{onClick:O},"应用到选中番剧")]),t("div",le,[e[10]||(e[10]=t("h2",null,"番剧分类",-1)),(l(!0),s(k,null,h(p.value,a=>(l(),s("div",{key:a.id,class:"anime-category-item"},[g(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=o=>y.value=o),value:a.id},null,8,ue),[[j,y.value]]),t("span",null,m(a.title),1),g(t("select",{"onUpdate:modelValue":o=>a.category=o,onChange:o=>R()},[e[9]||(e[9]=t("option",{value:""},"未分类",-1)),(l(!0),s(k,null,h(u.value,o=>(l(),s("option",{key:o.name,value:o.name},m(o.name),9,re))),128))],40,ie),[[N,a.category]])]))),128))]),t("div",ve,[t("button",{class:"save-btn",onClick:e[4]||(e[4]=(...a)=>n.saveAllChanges&&n.saveAllChanges(...a))},"保存所有更改")])])):(l(),s("div",ce,[t("div",{class:"restricted-access"},[e[11]||(e[11]=t("h1",null,"权限不足",-1)),e[12]||(e[12]=t("p",null,"您没有权限访问分类管理页面，请以管理员身份登录。",-1)),t("button",{class:"nav-btn",onClick:T},"返回")])]))]))}},ye=q(de,[["__scopeId","data-v-61ec5ae0"]]);export{ye as default};
