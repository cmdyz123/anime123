import{r,p as D,o as F,a as s,d as e,t as y,w as C,v as M,f as N,F as f,e as b,m as E,u as P,g as l,A as j}from"./vendor-B6wqEA49.js";import{_ as q,g as z}from"./index-CLZbKOHU.js";const G={class:"category-manager"},H={key:0},Q={class:"header-section"},W={class:"category-form"},X={class:"category-list"},Y=["onUpdate:modelValue","onBlur","onKeyup"],Z=["onClick"],x={class:"category-actions"},ee=["onClick"],te=["onClick"],oe=["onClick"],ae={class:"batch-category"},ne=["value"],se={class:"anime-categories"},le=["value"],ue=["onUpdate:modelValue","onChange"],re=["value"],ie={key:1},ce={__name:"CategoryManager",setup(ve){const h=P(),U=D(),B=r(localStorage.getItem("userRole")||"user"),i=r(U.params.month||"2025.10"),u=r(JSON.parse(localStorage.getItem(`animeCategories${i.value}`))||[{name:"原创动画"},{name:"动画官网"},{name:"PV"},{name:"先行画面"}]),d=r(""),m=r([]),v=r(-1),$=r(""),g=r([]),p=r(""),S=()=>{d.value.trim()&&(u.value.push({name:d.value.trim()}),d.value="",k())},J=o=>{u.value.splice(o,1),k()},k=()=>{localStorage.setItem(`animeCategories${i.value}`,JSON.stringify(u.value))},A=o=>{v.value=o,$.value=u.value[o].name},V=o=>{u.value[o].name.trim()?(v.value=-1,k()):(u.value[o].name=$.value,v.value=-1)},L=o=>{u.value[o].name=$.value,v.value=-1},O=()=>{if(!p.value){alert("请先选择分类");return}g.value.forEach(o=>{const t=m.value.find(a=>a.id===o);t&&(t.category=p.value)}),_()&&console.log(`批量分类完成，共更新 ${g.value.length} 部番剧`),g.value=[],p.value=""},R=()=>{i.value==="2026.1"?h.push({name:"Anime20261"}):h.push({name:"AnimeList"})},w=()=>{h.push({name:"Restricted"})},K=()=>{h.push({name:"MonthEditor",params:{month:i.value}})},_=()=>{try{return localStorage.setItem(`animeList${i.value}`,JSON.stringify(m.value)),!0}catch(o){return console.error("保存番剧列表失败:",o),!1}},T=o=>{_()&&console.log(`更新番剧 ${o.title} 的分类为 ${o.category}`)},I=()=>{try{k(),_()&&(alert("所有更改已保存"),console.log("所有分类更改已保存"))}catch(o){console.error("保存所有更改失败:",o),alert("保存失败，请检查浏览器存储设置")}};return F(()=>{try{const o=JSON.parse(localStorage.getItem(`animeList${i.value}`));if(o){const t=o.map(a=>({...a,image:z(a.image)}));m.value=t,JSON.stringify(t)!==JSON.stringify(o)&&_()}else m.value=[]}catch(o){console.error("加载番剧分类失败:",o),alert("加载分类失败，请检查浏览器存储设置")}}),(o,t)=>(l(),s("div",G,[B.value==="admin"?(l(),s("div",H,[e("div",Q,[e("h1",null,y(i.value.value)+" 分类管理",1),e("div",{class:"nav-buttons"},[e("button",{class:"nav-btn",onClick:R},"主页面"),e("button",{class:"nav-btn",onClick:K},"动漫编辑"),e("button",{class:"nav-btn save-btn",onClick:I},"保存所有更改")])]),e("div",W,[t[3]||(t[3]=e("h2",null,"添加新分类",-1)),C(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>d.value=a),placeholder:"输入分类名称",onKeyup:N(S,["enter"])},null,544),[[M,d.value]]),e("button",{onClick:S},"添加")]),e("div",X,[t[4]||(t[4]=e("h2",null,"现有分类",-1)),(l(!0),s(f,null,b(u.value,(a,n)=>(l(),s("div",{key:n,class:"category-item"},[v.value===n?C((l(),s("input",{key:0,type:"text","onUpdate:modelValue":c=>u.value[n].name=c,onBlur:c=>V(n),onKeyup:N(c=>V(n),["enter"]),class:"edit-input"},null,40,Y)),[[M,u.value[n].name]]):(l(),s("span",{key:1,onClick:c=>A(n)},y(a.name),9,Z)),e("div",x,[v.value===n?(l(),s("button",{key:0,onClick:c=>L(n)},"取消",8,ee)):(l(),s("button",{key:1,onClick:c=>A(n)},"编辑",8,te)),e("button",{onClick:c=>J(n)},"删除",8,oe)])]))),128))]),e("div",ae,[t[6]||(t[6]=e("h2",null,"批量分类",-1)),C(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>p.value=a)},[t[5]||(t[5]=e("option",{value:""},"选择分类",-1)),(l(!0),s(f,null,b(u.value,a=>(l(),s("option",{key:a.name,value:a.name},y(a.name),9,ne))),128))],512),[[E,p.value]]),e("button",{onClick:O},"应用到选中番剧")]),e("div",se,[t[8]||(t[8]=e("h2",null,"番剧分类",-1)),(l(!0),s(f,null,b(m.value,a=>(l(),s("div",{key:a.id,class:"anime-category-item"},[C(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=n=>g.value=n),value:a.id},null,8,le),[[j,g.value]]),e("span",null,y(a.title),1),C(e("select",{"onUpdate:modelValue":n=>a.category=n,onChange:n=>T(a)},[t[7]||(t[7]=e("option",{value:""},"未分类",-1)),(l(!0),s(f,null,b(u.value,n=>(l(),s("option",{key:n.name,value:n.name},y(n.name),9,re))),128))],40,ue),[[E,a.category]])]))),128))]),e("div",{class:"save-section"},[e("button",{class:"save-btn",onClick:I},"保存所有更改")])])):(l(),s("div",ie,[e("div",{class:"restricted-access"},[t[9]||(t[9]=e("h1",null,"权限不足",-1)),t[10]||(t[10]=e("p",null,"您没有权限访问分类管理页面，请以管理员身份登录。",-1)),e("button",{class:"nav-btn",onClick:w},"返回")])]))]))}},ge=q(ce,[["__scopeId","data-v-8cc76123"]]);export{ge as default};
