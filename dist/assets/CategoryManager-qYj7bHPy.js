import{_ as P,r,f as W,o as D,c as n,a as t,t as y,w as h,h as A,i as J,F as k,b as _,v as O,u as F,d as s,j}from"./index-C5gNJW2B.js";const q={class:"category-manager"},z={key:0},G={class:"header-section"},H={class:"category-form"},Q={class:"category-list"},X=["onUpdate:modelValue","onBlur","onKeyup"],Y=["onClick"],Z={class:"category-actions"},x=["onClick"],ee=["onClick"],te=["onClick"],ae={class:"batch-category"},oe=["value"],le={class:"anime-categories"},ne=["value"],se=["onUpdate:modelValue","onChange"],ie=["value"],ue={key:1},re={__name:"CategoryManager",setup(ce){const f=F(),V=W(),L=r(localStorage.getItem("userRole")||"user"),u=r(V.params.month||"2025.10"),i=r(JSON.parse(localStorage.getItem(`animeCategories${u.value}`))||[{name:"原创动画"},{name:"动画官网"},{name:"PV"},{name:"先行画面"}]),d=r(""),c=r([]),m=r(-1),b=r(""),g=r([]),p=r(""),M=o=>o.map(e=>{let a=e.image;return a&&(a.startsWith("/anime123/")&&(a=a.replace("/anime123/","/")),a.startsWith("public/")&&(a=a.replace("public/","/")),a.startsWith("/")||(a="/"+a)),{...e,image:a}}),S=()=>{d.value.trim()&&(i.value.push({name:d.value.trim()}),d.value="",C())},E=o=>{i.value.splice(o,1),C()},C=()=>{localStorage.setItem(`animeCategories${u.value}`,JSON.stringify(i.value))},$=o=>{m.value=o,b.value=i.value[o].name},I=o=>{i.value[o].name.trim()?(m.value=-1,C()):(i.value[o].name=b.value,m.value=-1)},U=o=>{i.value[o].name=b.value,m.value=-1},B=()=>{if(!p.value){alert("请先选择分类");return}g.value.forEach(o=>{const e=c.value.find(a=>a.id===o);e&&(e.category=p.value)}),localStorage.setItem(`animeList${u.value}`,JSON.stringify(c.value)),console.log(`批量分类完成，共更新 ${g.value.length} 部番剧`),g.value=[],p.value=""},R=()=>{u.value==="2026.1"?f.push({name:"Anime20261"}):f.push({name:"AnimeList"})},w=()=>{f.push({name:"Restricted"})},K=()=>{f.push({name:"MonthEditor",params:{month:u.value}})},T=o=>{try{localStorage.setItem(`animeList${u.value}`,JSON.stringify(c.value)),console.log(`更新番剧 ${o.title} 的分类为 ${o.category}`)}catch(e){console.error("保存番剧分类失败:",e),alert("保存分类失败，请检查浏览器存储设置")}},N=()=>{try{C(),localStorage.setItem(`animeList${u.value}`,JSON.stringify(c.value)),alert("所有更改已保存"),console.log("所有分类更改已保存")}catch(o){console.error("保存所有更改失败:",o),alert("保存失败，请检查浏览器存储设置")}};return D(()=>{try{const o=JSON.parse(localStorage.getItem(`animeList${u.value}`));if(o){const e=M(o);c.value=e,JSON.stringify(e)!==JSON.stringify(o)&&localStorage.setItem(`animeList${u.value}`,JSON.stringify(e))}else c.value=[]}catch(o){console.error("加载番剧分类失败:",o),alert("加载分类失败，请检查浏览器存储设置")}}),(o,e)=>(s(),n("div",q,[L.value==="admin"?(s(),n("div",z,[t("div",G,[t("h1",null,y(u.value.value)+" 分类管理",1),t("div",{class:"nav-buttons"},[t("button",{class:"nav-btn",onClick:R},"主页面"),t("button",{class:"nav-btn",onClick:K},"动漫编辑"),t("button",{class:"nav-btn save-btn",onClick:N},"保存所有更改")])]),t("div",H,[e[3]||(e[3]=t("h2",null,"添加新分类",-1)),h(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),placeholder:"输入分类名称",onKeyup:J(S,["enter"])},null,544),[[A,d.value]]),t("button",{onClick:S},"添加")]),t("div",Q,[e[4]||(e[4]=t("h2",null,"现有分类",-1)),(s(!0),n(k,null,_(i.value,(a,l)=>(s(),n("div",{key:l,class:"category-item"},[m.value===l?h((s(),n("input",{key:0,type:"text","onUpdate:modelValue":v=>i.value[l].name=v,onBlur:v=>I(l),onKeyup:J(v=>I(l),["enter"]),class:"edit-input"},null,40,X)),[[A,i.value[l].name]]):(s(),n("span",{key:1,onClick:v=>$(l)},y(a.name),9,Y)),t("div",Z,[m.value===l?(s(),n("button",{key:0,onClick:v=>U(l)},"取消",8,x)):(s(),n("button",{key:1,onClick:v=>$(l)},"编辑",8,ee)),t("button",{onClick:v=>E(l)},"删除",8,te)])]))),128))]),t("div",ae,[e[6]||(e[6]=t("h2",null,"批量分类",-1)),h(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>p.value=a)},[e[5]||(e[5]=t("option",{value:""},"选择分类",-1)),(s(!0),n(k,null,_(i.value,a=>(s(),n("option",{key:a.name,value:a.name},y(a.name),9,oe))),128))],512),[[O,p.value]]),t("button",{onClick:B},"应用到选中番剧")]),t("div",le,[e[8]||(e[8]=t("h2",null,"番剧分类",-1)),(s(!0),n(k,null,_(c.value,a=>(s(),n("div",{key:a.id,class:"anime-category-item"},[h(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=l=>g.value=l),value:a.id},null,8,ne),[[j,g.value]]),t("span",null,y(a.title),1),h(t("select",{"onUpdate:modelValue":l=>a.category=l,onChange:l=>T(a)},[e[7]||(e[7]=t("option",{value:""},"未分类",-1)),(s(!0),n(k,null,_(i.value,l=>(s(),n("option",{key:l.name,value:l.name},y(l.name),9,ie))),128))],40,se),[[O,a.category]])]))),128))]),t("div",{class:"save-section"},[t("button",{class:"save-btn",onClick:N},"保存所有更改")])])):(s(),n("div",ue,[t("div",{class:"restricted-access"},[e[9]||(e[9]=t("h1",null,"权限不足",-1)),e[10]||(e[10]=t("p",null,"您没有权限访问分类管理页面，请以管理员身份登录。",-1)),t("button",{class:"nav-btn",onClick:w},"返回")])]))]))}},me=P(re,[["__scopeId","data-v-381769f3"]]);export{me as default};
