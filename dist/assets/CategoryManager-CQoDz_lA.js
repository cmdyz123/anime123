import{_ as D,r,f as F,o as j,c as l,a as t,t as y,w as h,h as M,i as N,F as _,b,v as E,u as z,d as s,j as W}from"./index-Duvxap9o.js";const q={class:"category-manager"},G={key:0},H={class:"header-section"},Q={class:"category-form"},X={class:"category-list"},Y=["onUpdate:modelValue","onBlur","onKeyup"],Z=["onClick"],x={class:"category-actions"},ee=["onClick"],te=["onClick"],ae=["onClick"],oe={class:"batch-category"},ne=["value"],le={class:"anime-categories"},se=["value"],ue=["onUpdate:modelValue","onChange"],re=["value"],ie={key:1},ce={__name:"CategoryManager",setup(ve){const C=z(),U=F(),B=r(localStorage.getItem("userRole")||"user"),i=r(U.params.month||"2025.10"),u=r(JSON.parse(localStorage.getItem(`animeCategories${i.value}`))||[{name:"原创动画"},{name:"动画官网"},{name:"PV"},{name:"先行画面"}]),d=r(""),m=r([]),v=r(-1),$=r(""),g=r([]),p=r(""),J=a=>a.map(e=>{let o=e.image;return o&&(o=o.replace("/cmdyz123/","/").replace("/anime123/","/").replace("public/","/"),o.startsWith("/")||(o="/"+o)),{...e,image:o}}),S=()=>{d.value.trim()&&(u.value.push({name:d.value.trim()}),d.value="",f())},L=a=>{u.value.splice(a,1),f()},f=()=>{localStorage.setItem(`animeCategories${i.value}`,JSON.stringify(u.value))},A=a=>{v.value=a,$.value=u.value[a].name},V=a=>{u.value[a].name.trim()?(v.value=-1,f()):(u.value[a].name=$.value,v.value=-1)},O=a=>{u.value[a].name=$.value,v.value=-1},R=()=>{if(!p.value){alert("请先选择分类");return}g.value.forEach(a=>{const e=m.value.find(o=>o.id===a);e&&(e.category=p.value)}),k()&&console.log(`批量分类完成，共更新 ${g.value.length} 部番剧`),g.value=[],p.value=""},w=()=>{i.value==="2026.1"?C.push({name:"Anime20261"}):C.push({name:"AnimeList"})},K=()=>{C.push({name:"Restricted"})},T=()=>{C.push({name:"MonthEditor",params:{month:i.value}})},k=()=>{try{return localStorage.setItem(`animeList${i.value}`,JSON.stringify(m.value)),!0}catch(a){return console.error("保存番剧列表失败:",a),alert("保存失败，请检查浏览器存储设置"),!1}},P=a=>{k()&&console.log(`更新番剧 ${a.title} 的分类为 ${a.category}`)},I=()=>{try{f(),k()&&(alert("所有更改已保存"),console.log("所有分类更改已保存"))}catch(a){console.error("保存所有更改失败:",a),alert("保存失败，请检查浏览器存储设置")}};return j(()=>{try{const a=JSON.parse(localStorage.getItem(`animeList${i.value}`));if(a){const e=J(a);m.value=e,JSON.stringify(e)!==JSON.stringify(a)&&k()}else m.value=[]}catch(a){console.error("加载番剧分类失败:",a),alert("加载分类失败，请检查浏览器存储设置")}}),(a,e)=>(s(),l("div",q,[B.value==="admin"?(s(),l("div",G,[t("div",H,[t("h1",null,y(i.value.value)+" 分类管理",1),t("div",{class:"nav-buttons"},[t("button",{class:"nav-btn",onClick:w},"主页面"),t("button",{class:"nav-btn",onClick:T},"动漫编辑"),t("button",{class:"nav-btn save-btn",onClick:I},"保存所有更改")])]),t("div",Q,[e[3]||(e[3]=t("h2",null,"添加新分类",-1)),h(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>d.value=o),placeholder:"输入分类名称",onKeyup:N(S,["enter"])},null,544),[[M,d.value]]),t("button",{onClick:S},"添加")]),t("div",X,[e[4]||(e[4]=t("h2",null,"现有分类",-1)),(s(!0),l(_,null,b(u.value,(o,n)=>(s(),l("div",{key:n,class:"category-item"},[v.value===n?h((s(),l("input",{key:0,type:"text","onUpdate:modelValue":c=>u.value[n].name=c,onBlur:c=>V(n),onKeyup:N(c=>V(n),["enter"]),class:"edit-input"},null,40,Y)),[[M,u.value[n].name]]):(s(),l("span",{key:1,onClick:c=>A(n)},y(o.name),9,Z)),t("div",x,[v.value===n?(s(),l("button",{key:0,onClick:c=>O(n)},"取消",8,ee)):(s(),l("button",{key:1,onClick:c=>A(n)},"编辑",8,te)),t("button",{onClick:c=>L(n)},"删除",8,ae)])]))),128))]),t("div",oe,[e[6]||(e[6]=t("h2",null,"批量分类",-1)),h(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>p.value=o)},[e[5]||(e[5]=t("option",{value:""},"选择分类",-1)),(s(!0),l(_,null,b(u.value,o=>(s(),l("option",{key:o.name,value:o.name},y(o.name),9,ne))),128))],512),[[E,p.value]]),t("button",{onClick:R},"应用到选中番剧")]),t("div",le,[e[8]||(e[8]=t("h2",null,"番剧分类",-1)),(s(!0),l(_,null,b(m.value,o=>(s(),l("div",{key:o.id,class:"anime-category-item"},[h(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=n=>g.value=n),value:o.id},null,8,se),[[W,g.value]]),t("span",null,y(o.title),1),h(t("select",{"onUpdate:modelValue":n=>o.category=n,onChange:n=>P(o)},[e[7]||(e[7]=t("option",{value:""},"未分类",-1)),(s(!0),l(_,null,b(u.value,n=>(s(),l("option",{key:n.name,value:n.name},y(n.name),9,re))),128))],40,ue),[[E,o.category]])]))),128))]),t("div",{class:"save-section"},[t("button",{class:"save-btn",onClick:I},"保存所有更改")])])):(s(),l("div",ie,[t("div",{class:"restricted-access"},[e[9]||(e[9]=t("h1",null,"权限不足",-1)),e[10]||(e[10]=t("p",null,"您没有权限访问分类管理页面，请以管理员身份登录。",-1)),t("button",{class:"nav-btn",onClick:K},"返回")])]))]))}},me=D(ce,[["__scopeId","data-v-a06f1a97"]]);export{me as default};
