import{r as v,p as w,A as L,o as V,a as n,d as o,t as m,w as g,v as I,f as E,F as c,e as p,m as N,u as B,g as l,B as U}from"./vendor-5ySKIXvH.js";import{_ as T,g as _,f as R}from"./index-BVvwcoFC.js";const K={class:"category-manager"},D={key:0},F={class:"header-section"},P={class:"nav-buttons"},j={class:"category-form"},q={class:"category-list"},z=["onUpdate:modelValue","onBlur","onKeyup"],G=["onClick"],H={class:"category-actions"},Q=["onClick"],W=["onClick"],X=["onClick"],Y={class:"batch-category"},Z=["value"],x={class:"anime-categories"},ee=["value"],te=["onUpdate:modelValue","onChange"],oe=["value"],ae={class:"save-section"},se={key:1},ne={class:"restricted-access"},le={__name:"CategoryManager",setup(ie){const y=B(),k=w(),i=v(k.params.month||"2025.10"),r=v([]),C=v(""),f=v([]),b=v([]),d=v([]),A=()=>{i.value==="2026.1"?y.push({name:"Anime20261"}):y.push({name:"AnimeMonth",params:{month:i.value}})},J=()=>{y.push({name:"MonthEditor",params:{month:i.value}})},S=()=>{try{const t=JSON.parse(localStorage.getItem(`animeList${i.value}`))||[],e=t.map(s=>({...s,image:_(s.image)}));JSON.stringify(e)!==JSON.stringify(t)?(localStorage.setItem(`animeList${i.value}`,JSON.stringify(e)),d.value=e):d.value=t;const a=JSON.parse(localStorage.getItem(`animeCategories${i.value}`))||[];r.value=a,f.value=R(t)}catch(t){console.error("加载动漫数据时出错:",t)}},$=()=>{if(C.value.trim()==="")return;const t={name:C.value.trim()};r.value.push(t),localStorage.setItem(`animeCategories${i.value}`,JSON.stringify(r.value)),C.value=""},M=t=>{r.value=r.value.filter(e=>e.name!==t),d.value.forEach(e=>{e.category===t&&(e.category="")}),localStorage.setItem(`animeCategories${i.value}`,JSON.stringify(r.value)),localStorage.setItem(`animeList${i.value}`,JSON.stringify(d.value))},h=v(""),O=()=>{h.value&&(b.value.forEach(t=>{const e=d.value.find(a=>a.id===t);e&&(e.category=h.value)}),localStorage.setItem(`animeList${i.value}`,JSON.stringify(d.value)),b.value=[],h.value="",A())};return L(()=>k.params.month,t=>{i.value=t||"2025.10",S()}),V(()=>{try{S()}catch(t){console.error("加载数据出错:",t)}}),(t,e)=>(l(),n("div",K,[t.userRole==="admin"?(l(),n("div",D,[o("div",F,[o("h1",null,m(i.value.value)+" 分类管理",1),o("div",P,[o("button",{class:"nav-btn",onClick:A},"主页面"),o("button",{class:"nav-btn",onClick:J},"动漫编辑"),o("button",{class:"nav-btn save-btn",onClick:e[0]||(e[0]=(...a)=>t.saveAllChanges&&t.saveAllChanges(...a))},"保存所有更改")])]),o("div",j,[e[6]||(e[6]=o("h2",null,"添加新分类",-1)),g(o("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=a=>t.newCategory=a),placeholder:"输入分类名称",onKeyup:E($,["enter"])},null,544),[[I,t.newCategory]]),o("button",{onClick:$},"添加")]),o("div",q,[e[7]||(e[7]=o("h2",null,"现有分类",-1)),(l(!0),n(c,null,p(r.value,(a,s)=>(l(),n("div",{key:s,class:"category-item"},[t.editingIndex===s?g((l(),n("input",{key:0,type:"text","onUpdate:modelValue":u=>r.value[s].name=u,onBlur:u=>t.saveEdit(s),onKeyup:E(u=>t.saveEdit(s),["enter"]),class:"edit-input"},null,40,z)),[[I,r.value[s].name]]):(l(),n("span",{key:1,onClick:u=>t.startEdit(s)},m(a.name),9,G)),o("div",H,[t.editingIndex===s?(l(),n("button",{key:0,onClick:u=>t.cancelEdit(s)},"取消",8,Q)):(l(),n("button",{key:1,onClick:u=>t.startEdit(s)},"编辑",8,W)),o("button",{onClick:u=>M(s)},"删除",8,X)])]))),128))]),o("div",Y,[e[9]||(e[9]=o("h2",null,"批量分类",-1)),g(o("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.batchCategory=a)},[e[8]||(e[8]=o("option",{value:""},"选择分类",-1)),(l(!0),n(c,null,p(r.value,a=>(l(),n("option",{key:a.name,value:a.name},m(a.name),9,Z))),128))],512),[[N,t.batchCategory]]),o("button",{onClick:O},"应用到选中番剧")]),o("div",x,[e[11]||(e[11]=o("h2",null,"番剧分类",-1)),(l(!0),n(c,null,p(f.value,a=>(l(),n("div",{key:a.id,class:"anime-category-item"},[g(o("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=s=>t.selectedAnimes=s),value:a.id},null,8,ee),[[U,t.selectedAnimes]]),o("span",null,m(a.title),1),g(o("select",{"onUpdate:modelValue":s=>a.category=s,onChange:s=>t.updateCategory(a)},[e[10]||(e[10]=o("option",{value:""},"未分类",-1)),(l(!0),n(c,null,p(r.value,s=>(l(),n("option",{key:s.name,value:s.name},m(s.name),9,oe))),128))],40,te),[[N,a.category]])]))),128))]),o("div",ae,[o("button",{class:"save-btn",onClick:e[4]||(e[4]=(...a)=>t.saveAllChanges&&t.saveAllChanges(...a))},"保存所有更改")])])):(l(),n("div",se,[o("div",ne,[e[12]||(e[12]=o("h1",null,"权限不足",-1)),e[13]||(e[13]=o("p",null,"您没有权限访问分类管理页面，请以管理员身份登录。",-1)),o("button",{class:"nav-btn",onClick:e[5]||(e[5]=(...a)=>t.goToRestricted&&t.goToRestricted(...a))},"返回")])]))]))}},ve=T(le,[["__scopeId","data-v-e28aa166"]]);export{ve as default};
