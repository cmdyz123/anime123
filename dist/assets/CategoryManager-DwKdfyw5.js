import{_ as W,r,f as P,o as z,c as s,a,t as y,w as h,h as A,i as J,F as k,b as _,v as O,u as D,d as n,j as F}from"./index-DIkVWmOn.js";const j={class:"category-manager"},q={key:0},G={class:"header-section"},H={class:"category-form"},Q={class:"category-list"},X=["onUpdate:modelValue","onBlur","onKeyup"],Y=["onClick"],Z={class:"category-actions"},x=["onClick"],ee=["onClick"],te=["onClick"],ae={class:"batch-category"},oe=["value"],le={class:"anime-categories"},se=["value"],ne=["onUpdate:modelValue","onChange"],ie=["value"],ue={key:1},re={__name:"CategoryManager",setup(ce){const f=D(),V=P(),L=r(localStorage.getItem("userRole")||"user"),u=r(V.params.month||"2025.10"),i=r(JSON.parse(localStorage.getItem(`animeCategories${u.value}`))||[{name:"原创动画"},{name:"动画官网"},{name:"PV"},{name:"先行画面"}]),d=r(""),c=r([]),m=r(-1),b=r(""),g=r([]),p=r(""),M=o=>o.map(e=>{let t=e.image;return t&&(t.startsWith("/cmdyz123/")&&(t=t.replace("/cmdyz123/","/")),t.startsWith("/anime123/")&&(t=t.replace("/anime123/","/")),t.startsWith("public/")&&(t=t.replace("public/","/")),t.startsWith("/")||(t="/"+t)),{...e,image:t}}),S=()=>{d.value.trim()&&(i.value.push({name:d.value.trim()}),d.value="",C())},E=o=>{i.value.splice(o,1),C()},C=()=>{localStorage.setItem(`animeCategories${u.value}`,JSON.stringify(i.value))},$=o=>{m.value=o,b.value=i.value[o].name},I=o=>{i.value[o].name.trim()?(m.value=-1,C()):(i.value[o].name=b.value,m.value=-1)},U=o=>{i.value[o].name=b.value,m.value=-1},B=()=>{if(!p.value){alert("请先选择分类");return}g.value.forEach(o=>{const e=c.value.find(t=>t.id===o);e&&(e.category=p.value)}),localStorage.setItem(`animeList${u.value}`,JSON.stringify(c.value)),console.log(`批量分类完成，共更新 ${g.value.length} 部番剧`),g.value=[],p.value=""},R=()=>{u.value==="2026.1"?f.push({name:"Anime20261"}):f.push({name:"AnimeList"})},w=()=>{f.push({name:"Restricted"})},K=()=>{f.push({name:"MonthEditor",params:{month:u.value}})},T=o=>{try{localStorage.setItem(`animeList${u.value}`,JSON.stringify(c.value)),console.log(`更新番剧 ${o.title} 的分类为 ${o.category}`)}catch(e){console.error("保存番剧分类失败:",e),alert("保存分类失败，请检查浏览器存储设置")}},N=()=>{try{C(),localStorage.setItem(`animeList${u.value}`,JSON.stringify(c.value)),alert("所有更改已保存"),console.log("所有分类更改已保存")}catch(o){console.error("保存所有更改失败:",o),alert("保存失败，请检查浏览器存储设置")}};return z(()=>{try{const o=JSON.parse(localStorage.getItem(`animeList${u.value}`));if(o){const e=M(o);c.value=e,JSON.stringify(e)!==JSON.stringify(o)&&localStorage.setItem(`animeList${u.value}`,JSON.stringify(e))}else c.value=[]}catch(o){console.error("加载番剧分类失败:",o),alert("加载分类失败，请检查浏览器存储设置")}}),(o,e)=>(n(),s("div",j,[L.value==="admin"?(n(),s("div",q,[a("div",G,[a("h1",null,y(u.value.value)+" 分类管理",1),a("div",{class:"nav-buttons"},[a("button",{class:"nav-btn",onClick:R},"主页面"),a("button",{class:"nav-btn",onClick:K},"动漫编辑"),a("button",{class:"nav-btn save-btn",onClick:N},"保存所有更改")])]),a("div",H,[e[3]||(e[3]=a("h2",null,"添加新分类",-1)),h(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),placeholder:"输入分类名称",onKeyup:J(S,["enter"])},null,544),[[A,d.value]]),a("button",{onClick:S},"添加")]),a("div",Q,[e[4]||(e[4]=a("h2",null,"现有分类",-1)),(n(!0),s(k,null,_(i.value,(t,l)=>(n(),s("div",{key:l,class:"category-item"},[m.value===l?h((n(),s("input",{key:0,type:"text","onUpdate:modelValue":v=>i.value[l].name=v,onBlur:v=>I(l),onKeyup:J(v=>I(l),["enter"]),class:"edit-input"},null,40,X)),[[A,i.value[l].name]]):(n(),s("span",{key:1,onClick:v=>$(l)},y(t.name),9,Y)),a("div",Z,[m.value===l?(n(),s("button",{key:0,onClick:v=>U(l)},"取消",8,x)):(n(),s("button",{key:1,onClick:v=>$(l)},"编辑",8,ee)),a("button",{onClick:v=>E(l)},"删除",8,te)])]))),128))]),a("div",ae,[e[6]||(e[6]=a("h2",null,"批量分类",-1)),h(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t)},[e[5]||(e[5]=a("option",{value:""},"选择分类",-1)),(n(!0),s(k,null,_(i.value,t=>(n(),s("option",{key:t.name,value:t.name},y(t.name),9,oe))),128))],512),[[O,p.value]]),a("button",{onClick:B},"应用到选中番剧")]),a("div",le,[e[8]||(e[8]=a("h2",null,"番剧分类",-1)),(n(!0),s(k,null,_(c.value,t=>(n(),s("div",{key:t.id,class:"anime-category-item"},[h(a("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=l=>g.value=l),value:t.id},null,8,se),[[F,g.value]]),a("span",null,y(t.title),1),h(a("select",{"onUpdate:modelValue":l=>t.category=l,onChange:l=>T(t)},[e[7]||(e[7]=a("option",{value:""},"未分类",-1)),(n(!0),s(k,null,_(i.value,l=>(n(),s("option",{key:l.name,value:l.name},y(l.name),9,ie))),128))],40,ne),[[O,t.category]])]))),128))]),a("div",{class:"save-section"},[a("button",{class:"save-btn",onClick:N},"保存所有更改")])])):(n(),s("div",ue,[a("div",{class:"restricted-access"},[e[9]||(e[9]=a("h1",null,"权限不足",-1)),e[10]||(e[10]=a("p",null,"您没有权限访问分类管理页面，请以管理员身份登录。",-1)),a("button",{class:"nav-btn",onClick:w},"返回")])]))]))}},me=W(re,[["__scopeId","data-v-1453c434"]]);export{me as default};
